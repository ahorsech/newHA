dd_light:

    homeassistant:
      customize:
        
        light.0x00158d000420dbab:
          friendly_name: Детская Д, бра
          icon: mdi:coach-lamp
        switch.0x00158d000420dbab_power_outage_memory:
          friendly_name: Детская Д, бра память состояния

        light.dd_ceiling_light:
          friendly_name: Детская Д, люстра
          icon: mdi:ceiling-light
          
        light.dd_wled_light:
          friendly_name: Детская Д, адресная лента
          icon: mdi:led-strip-variant
          
        light.dd_table_lamp:
          friendly_name: Детская Д, настольная лампа
          icon: mdi:desk-lamp

        sensor.0x00158d000163e571_action:
          friendly_name: Детская Д, выключатель на входе
        sensor.0x00158d000163e571_battery:
          friendly_name: Детская Д, выключатель на входе

        sensor.0x00158d0003d50723_action:
          friendly_name: Детская Д, выключатель возле кровати
        sensor.0x00158d0003d50723_battery:
          friendly_name: Детская Д, выключатель возле кровати

    switch:

      - platform: template
        switches:
          dd_table_lamp:
            friendly_name: "Детская Д, питание настольной лампы"
            value_template: "{{ states('sensor.0x00158d00030a6e78_power') | float > 5 }}"
            turn_on:
              service: switch.turn_on
              data:
                entity_id: switch.0x00158d00030a6e78
            turn_off:
              service: switch.turn_off
              data:
                entity_id: switch.0x00158d00030a6e78
                
    light:

      - platform: switch
        name: dd_table_lamp
        entity_id: switch.dd_table_lamp

    automation:

      - id: Детская Д, ручное управление люстрой
        alias: dd_ceiling_light_manual_control
        initial_state: true
        trigger:
    # Выключатель на входе
        - platform: state
          entity_id: sensor.0x00158d000163e571_action
          to: 'single_right'
    # Выключатель возле кровати
        - platform: state
          entity_id: sensor.0x00158d0003d50723_action
          to: 'left'
        condition:
        - condition: state
          entity_id: switch.control_mode
          state: 'on'
        action:
            - choose:
              - conditions:
                  - condition: state
                    entity_id: light.dd_ceiling_light
                    state: 'off'
                sequence:
                  - service: xiaomi_miio.light_set_scene
                    entity_id: light.dd_ceiling_light
                    data:
                       scene: 1 
              - conditions:
                  - condition: state
                    entity_id: light.dd_ceiling_light
                    state: 'on'
                sequence:
                  - service: light.turn_off
                    entity_id:
                      - light.dd_ceiling_light
                      
      - id: Детская Д, ручное управление бра
        alias: dd_bra_light_manual_control
        initial_state: true
        trigger:
    # Выключатель на входе
        - platform: state
          entity_id: sensor.0x00158d000163e571_action
          to: 'single_left'
    # Выключатель возле кровати
        - platform: state
          entity_id: sensor.0x00158d0003d50723_action
          to: 'right'
        condition:
        - condition: state
          entity_id: switch.control_mode
          state: 'on'
        action:
            - choose:
              - conditions:
                  - condition: state
                    entity_id: light.0x00158d000420dbab
                    state: 'off'
                sequence:
                  - service: light.turn_on
                    entity_id:
                      -  light.0x00158d000420dbab
                    data_template:
                      brightness_pct: 100
                      kelvin: 4000
              - conditions:
                  - condition: state
                    entity_id: light.0x00158d000420dbab
                    state: 'on'
                sequence:
                  - service: light.turn_off
                    entity_id:
                      - light.0x00158d000420dbab
                      

      - id: Детская Д, включение питания на настольную лампу
        alias: dd_table_autoswitch
        initial_state: true
        trigger:
        - platform: state
          entity_id: switch.0x00158d00030a6e78
          to: 'off'
        condition:
        - condition: state
          entity_id: switch.control_mode
          state: 'on'
        action:
        - delay: 00:00:03
        - service: switch.turn_on
          entity_id:
            - switch.0x00158d00030a6e78
            
      - id: Детская Д, выключение всего освещения
        alias: dd_all_light_off
        initial_state: true
        trigger:
    # # Выключатель возле кровати
        - platform: state
          entity_id: sensor.0x00158d0003d50723_action
          to: 'both'
        condition:
        - condition: state
          entity_id: switch.control_mode
          state: 'on'
        action:
        - service: light.turn_off
          entity_id:
            - light.0x00158d000420dbab
            - light.dd_ceiling_light
            - light.dd_table_lamp
            - light.dd_wled_light
            
      - id: Детская Д, выключение всего освещения без ленты
        alias: dd_wwled_light_off
        initial_state: true
        trigger:
    # Выключатель на входе
        - platform: state
          entity_id: sensor.0x00158d000163e571_action
          to: 'single_both'
        condition:
        - condition: state
          entity_id: switch.control_mode
          state: 'on'
        action:
        - service: light.turn_off
          entity_id:
            - light.0x00158d000420dbab
            - light.dd_ceiling_light
            - light.dd_table_lamp

