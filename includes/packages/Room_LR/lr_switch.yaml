lr_switch:

    recorder:
      include:
        entities:
           - sensor.lr_total_load
           - sensor.0xa4c1388c89a46970_power
           - sensor.0xa4c138f41459f92a_power
           - sensor.0xa4c1387c6584d955_power
           - sensor.0x588e81fffed4af56_power
           - sensor.lr_strip_usb_power
           - sensor.lr_usb_socket_power
           - sensor.lr_6x_power_strip_power


    sensor:
    
      - platform: integration
        name: '0x588e81fffed4af56_integration'
        source: sensor.0x588e81fffed4af56_power
        unit_prefix: k
        round: 2
        
      - platform: integration
        name: '0xa4c1388c89a46970_integration'
        source: sensor.0xa4c1388c89a46970_power
        unit_prefix: k
        round: 2
        
      - platform: integration
        name: '0xa4c138f41459f92a_integration'
        source: sensor.0xa4c138f41459f92a_power
        unit_prefix: k
        round: 2
        
    utility_meter:

      0x588e81fffed4af56_meter:
        source: sensor.0x588e81fffed4af56_integration
        cycle: monthly

      0xa4c1388c89a46970_meter:
        source: sensor.0xa4c1388c89a46970_integration
        cycle: monthly
        
      0xa4c138f41459f92a_meter:
        source: sensor.0xa4c138f41459f92a_integration
        cycle: monthly
           
    homeassistant:
      customize:
        
        sensor.lr_total_load:
          friendly_name: Гостиная мощность
          device_class: power
          unit_of_measurement: Вт        
        
        switch.0xa4c1388c89a46970:
          friendly_name: Гостиная ноутбук Acer, питание
          icon: mdi:power-socket-eu
        sensor.0xa4c1388c89a46970_power:
          friendly_name: Гостиная ноутбук Acer, мощность
          unit_of_measurement: Вт
          device_class: power
        sensor.0xa4c1388c89a46970_energy:
          friendly_name: Гостиная ноутбук Acer, энергия
          icon: mdi:chart-line
        sensor.0xa4c1388c89a46970_voltage:
          friendly_name: Гостиная ноутбук Acer, напряжение
        sensor.0xa4c1388c89a46970_integration:
          friendly_name: Гостиная ноутбук Acer
        sensor.0xa4c1388c89a46970_meter:
          friendly_name: Гостиная ноутбук Acer
          unit_of_measurement: кВт/ч
          
        switch.0xa4c138f41459f92a:
          friendly_name: Гостиная ноутбук Asus, питание
          icon: mdi:power-socket-eu
        sensor.0xa4c138f41459f92a_power:
          friendly_name: Гостиная ноутбук Asus, мощность
          unit_of_measurement: Вт
          device_class: power
        sensor.0xa4c138f41459f92a_energy:
          friendly_name: Гостиная ноутбук Asus, энергия
          icon: mdi:chart-line
        sensor.0xa4c138f41459f92a_voltage:
          friendly_name: Гостиная ноутбук Asus, напряжение
        sensor.0xa4c138f41459f92a_integration:
          friendly_name: Гостиная ноутбук Asus
        sensor.0xa4c138f41459f92a_meter:
          friendly_name: Гостиная ноутбук Asus
          unit_of_measurement: кВт/ч
          
        switch.0xa4c1387c6584d955:
          friendly_name: Гостиная, питание шлюза
          icon: mdi:power-socket-eu
        sensor.0xa4c1387c6584d955_power:
          friendly_name: Гостиная, питание шлюза, мощность
          unit_of_measurement: Вт
          device_class: power
        sensor.0xa4c1387c6584d955_energy:
          friendly_name: Гостиная, питание шлюза, энергия
          icon: mdi:chart-line
        sensor.0xa4c1387c6584d955_voltage:
          friendly_name: Гостиная, питание шлюза, напряжение
          
        switch.0x588e81fffed4af56:
          friendly_name: Гостиная лампа за ТВ, питание
          icon: mdi:power-socket-eu
        sensor.0x588e81fffed4af56_power:
          friendly_name: Гостиная лампа за ТВ, мощность
          unit_of_measurement: Вт
          device_class: power
        sensor.0x588e81fffed4af56_energy:
          friendly_name: Гостиная лампа за ТВ, энергия
          icon: mdi:chart-line
        sensor.0x588e81fffed4af56_voltage:
          friendly_name: Гостиная лампа за ТВ, напряжение
        sensor.0x588e81fffed4af56_integration:
          friendly_name: Гостиная лампа за ТВ
        sensor.0x588e81fffed4af56_meter:
          friendly_name: Гостиная лампа за ТВ
          unit_of_measurement: кВт/ч
          
        switch.lr_usb_socket:
          friendly_name: Гостиная, часы
        switch.lr_usb_socket_usb:
          friendly_name: Гостиная, вентилятор роутера
        sensor.lr_usb_socket_power:
          friendly_name: Гостиная, USB розетка

        switch.power_strip_usb:
          friendly_name: Гостиная, удлинитель с USB
        sensor.lr_strip_usb_power:
          friendly_name: Гостиная, удлинитель с USB
          
        switch.lr_6x_power_strip:
          friendly_name: Гостиная, удлинитель 6 розеток 
        sensor.lr_6x_power_strip_power:
          friendly_name: Гостиная, удлинитель 6 розеток 
          
    template:
     
      - sensor:

          - name: lr_total_load
            state: > 
                {{states('sensor.0xa4c1388c89a46970_power')|float(0) + states('sensor.0xa4c138f41459f92a_power')|float(0)
                + states('sensor.0xa4c1384452a34172_power')|float(0) + states('sensor.0xa4c1387c6584d955_power')|float(0) + states('sensor.0x588e81fffed4af56_power')|float(0)
                + states('sensor.lr_strip_usb_power')|float(0) + states('sensor.lr_usb_socket_power')|float(0) + states('sensor.lr_6x_power_strip_power')|float(0)}}  
    
          - name: lr_strip_usb_power
            state: >
                {% if state_attr('switch.power_strip_usb', 'load_power')%}
                {{state_attr('switch.power_strip_usb', 'load_power')}}
                {% else %}
                0
                {% endif %}
            
          - name: lr_usb_socket_power
            state: >
                {% if state_attr('switch.lr_usb_socket', 'load_power')%}
                {{state_attr('switch.lr_usb_socket', 'load_power')}}
                {% else %}
                0
                {% endif %}

          - name: lr_6x_power_strip_power
            state: >
                {% if state_attr('switch.lr_6x_power_strip', 'load_power')%}
                {{state_attr('switch.lr_6x_power_strip', 'load_power') - states('sensor.0xa4c1387c6584d955_power')|float(0) - states('sensor.0xa4c1384452a34172_power')|float(0)}}
                {% else %}
                0
                {% endif %}
                
